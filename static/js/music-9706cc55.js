import{d as C,a as g,l as ee,g as i,c as u,b as l,h as H,t as U,m as n,n as A,e as L,q as se,s as te,u as oe,f as F,_ as le,v as ce,w as B,x as ne,r as Y,o as ae,y as re,F as P,z as T,A as j,B as ie}from"./index-ed5ac4b7.js";import{s as J,u as ue,g as x,a as k,p as de}from"./counter-18d95efc.js";const me={class:"header"},ge=["src"],_e=C({__name:"header",emits:["getMusicInfo"],setup(_,{emit:r}){let a=g("");const f="Ali-music",M=oe(),p=J(),w=ue(),y=async d=>{p.setKey(a.value?a.value:d);const $={keywords:a.value?a.value:d,limit:30};try{const b=await x(k.getAllList,{params:$});console.log("..music",b),b.code===200&&(console.log(".............."),r("getMusicInfo",b.result))}catch(b){console.log("..search..",b)}},h=g(!1),c=()=>{h.value=!h.value},V=async()=>{try{const d=await de(k.logout,{});console.log("退出",d),d.code===200&&M.replace("/")}catch(d){console.log(d)}},S=g(sessionStorage.getItem("login"));return ee(()=>{y("热歌")}),(d,$)=>{const b=F("el-input");return i(),u("div",me,[l("div",{class:"tit",onMouseenter:c,onMouseleave:c},[H(U(n(f)),1),h.value?(i(),u("span",{key:0,style:{"margin-left":"12px",cursor:"pointer"},onClick:V},"logout")):A("",!0)],32),L(b,{class:"input",modelValue:n(a),"onUpdate:modelValue":$[0]||($[0]=I=>se(a)?a.value=I:a=I),onKeydown:te(y,["enter"]),placeholder:"Please enter params to search music"},null,8,["modelValue","onKeydown"]),S.value?(i(),u("img",{key:0,src:n(w).userInfo.avatarUrl,draggable:"false",alt:"tou"},null,8,ge)):A("",!0)])}}});const pe=le(_e,[["__scopeId","data-v-df7b0487"]]),ye={class:"footer"},he=["src"],ve=C({__name:"footer",props:{musicUrl:null,stopFlag:null},emits:["getShow"],setup(_,{emit:r}){const a=_,f=()=>{console.log("...pause.."),r("getShow",!1)},M=()=>{console.log("...play.."),r("getShow",!0)};return(p,w)=>(i(),u("div",ye,[l("audio",{src:a.musicUrl,autoplay:"",controls:"",onPause:f,onPlay:M},null,40,he)]))}});const fe=""+new URL("../png/2-ab436541.png",import.meta.url).href,we=""+new URL("../png/1-23e4b9df.png",import.meta.url).href,Me=["src"],Se={class:"dialog-footer"},be=C({__name:"mv",props:{dialogVisible:{type:Boolean},musicName:null,mvUrl:null},emits:["close"],setup(_,{emit:r}){const a=_,f=()=>{r("close",!1)};return(M,p)=>{const w=F("el-button"),y=F("el-dialog");return i(),ce(y,{modelValue:a.dialogVisible,"onUpdate:modelValue":p[0]||(p[0]=h=>a.dialogVisible=h),title:_.musicName,width:"60%",center:"",draggable:""},{footer:B(()=>[l("span",Se,[L(w,{onClick:f},{default:B(()=>[H("Cancel")]),_:1})])]),default:B(()=>[l("video",{class:"video",src:_.mvUrl,autoplay:"",controls:""},null,8,Me)]),_:1},8,["modelValue","title"])}}});const Ue={class:"content"},ke={class:"music"},xe=["onClick"],Ve=["onClick"],$e=l("i",{class:"cont"},null,-1),Le=[$e],Ce={class:"main"},Ie=["src"],qe={class:"lyric"},Ne={class:"lyric_item lyric_active left"},Be={class:"lyric_item right"},Pe=l("div",{class:"head-right"},"评论：",-1),Te={class:"list"},Ae={class:"top"},Fe=["src"],He={class:"name"},Ke={class:"content-text"},Re={class:"ip"},Ee={class:"time"},Ge=C({__name:"content",props:{songs:null,show:{type:Boolean}},emits:["getMusicUrl","getMusicInfo","stopMusic"],setup(_,{emit:r}){let f=ne(_),M=g(""),p=g(0),w=g(""),y=g(""),h=g(!1),c=g();const V=s=>{var t;h.value=s,y.value="",(t=document.querySelector("audio"))==null||t.play()},S=s=>{M.value=s.al.picUrl,r("getMusicUrl",s.id),$(s.id),O(s.id),p.value=s.id,w.value=s.name};let d=Y({msgs:[]});const $=async s=>{let t={id:s};try{const e=await x(k.getLyric,{params:t});e.code===200&&I(e.lrc.lyric)}catch(e){console.log(e)}},b=s=>{const t=s.split("[")[1].split("]")[0];let e=parseInt(t.split(":")[0]),o=parseInt(t.split(":")[1].split(".")[0]),m=t.split(".")[1],v="";return e>0&&(o+=e*60),v=o+"."+m,v},I=s=>{let t=s.split(`
`),e=[];t.map((o,m)=>{let v={id:0,lyricTime:"",lyric:""};if(o!==""){let N=o.match(/\[\d{2}:\d{2}.\d{2,3}\]/)||"";v.lyricTime=b(N[0]),v.id=m+1,v.lyric=o.split("]")[1],e.push(v)}}),c.value=e};let K=g(0);const R=()=>{var e;let s=((e=document.querySelector("audio"))==null?void 0:e.currentTime)||0,t=c.value;t==null||t.forEach((o,m)=>{s>Number(o.lyricTime)&&(K.value=m)})},O=async s=>{let t={id:s,limit:30};try{const e=await x(k.getMsg,{params:t});console.log("....msg....",e),e.code===200&&(d.msgs=e.comments)}catch(e){console.log(e)}},Q=async s=>{let t={id:s,limit:30,offset:(q-1)*30};try{const e=await x(k.getMsg,{params:t});console.log("....moremsg....",e),e.code===200&&d.msgs.push(...e.comments)}catch(e){console.log(e)}},W=async s=>{const t={id:s,r:1080};f.songs.map(o=>o.mv===s&&(w.value=o.name));const e=document.querySelector("audio");try{const o=await x(k.getMVurl,{params:t});console.log(o),o.code===200&&(y.value=o.data.url)&&(h.value=!0)&&(e==null||e.pause())}catch(o){console.log(o)}};let q=1;const X=async s=>{const t={keywords:s,limit:30,offset:(q-1)*30};try{const e=await x(k.getAllList,{params:t});console.log("..music",e),e.code===200&&r("getMusicInfo",e.result)}catch(e){console.log("..search..",e)}},Z=J().keywords,E=s=>{var m,v,N,G,z,D;let t=null,e=null,o=null;s==="music"?(t=(m=document.querySelector(".left"))==null?void 0:m.scrollTop,e=(v=document.querySelector(".music"))==null?void 0:v.scrollHeight,o=(N=document.querySelector(".left"))==null?void 0:N.clientHeight,e-t+10<=o&&(console.log(".....//"),q++,X(Z))):(t=(G=document.querySelector(".content>.right"))==null?void 0:G.scrollTop,e=(z=document.querySelector(".list"))==null?void 0:z.scrollHeight,o=(D=document.querySelector(".content>.right"))==null?void 0:D.clientHeight,console.log("---------------",t,e,o),e-t+30<=o&&(console.log("...../...."),q++,Q(p.value)))};return ae(()=>{var s;return(s=document.querySelector("audio"))==null?void 0:s.addEventListener("timeupdate",R)}),re(()=>{var s;return(s=document.querySelector("audio"))==null?void 0:s.removeEventListener("timeupdate",R)}),(s,t)=>(i(),u("div",Ue,[l("div",{class:"left",onScroll:t[0]||(t[0]=e=>E("music"))},[l("div",ke,[(i(!0),u(P,null,T(n(f).songs,e=>(i(),u("div",{class:"item",key:e.id},[l("span",{class:"name",onClick:o=>S(e)},U(e.name),9,xe),e.mv?(i(),u("i",{key:0,class:"mv",onClick:o=>W(e.mv)},Le,8,Ve)):A("",!0)]))),128))])],32),l("div",Ce,[l("img",{draggable:"false",class:j(_.show?"roaid rotate2":"roaid"),src:fe,alt:"music"},null,2),l("img",{draggable:"false",class:j(["musicp",_.show?"rotate1":""]),src:we,alt:"music"},null,2),l("img",{draggable:"false",class:"pic",src:n(M)},null,8,Ie),l("div",qe,[(i(!0),u(P,null,T(n(c),(e,o)=>{var m;return i(),u("div",{style:ie(n(K)===o?`display:block;transform: translateY(${-4}px)`:"display:none"),key:e.id},[l("p",Ne,U(e.lyric),1),l("p",Be,U(n(c)?(m=n(c)[o+1])==null?void 0:m.lyric:""),1)],4)}),128))])]),l("div",{class:"right",onScroll:t[1]||(t[1]=e=>E("msg"))},[Pe,l("div",Te,[(i(!0),u(P,null,T(n(d).msgs,e=>(i(),u("div",{class:"user",key:e.commentId},[l("div",Ae,[l("img",{src:e.user.avatarUrl,alt:"tou"},null,8,Fe),l("span",He,U(e.user.nickname),1)]),l("div",Ke,U(e.content),1),l("div",Re,[l("span",Ee,U(e.timeStr),1),H(U(e.ipLocation.location),1)])]))),128))])],32),L(be,{musicName:n(w),mvUrl:n(y),dialogVisible:n(h),onClose:V},null,8,["musicName","mvUrl","dialogVisible"])]))}});const ze={class:"warp"},Je=C({__name:"music",setup(_){let r=Y({url:"",songs:[]});const a=c=>{console.log("...music...",c),c.songs&&(r.songs=c.songs)},f=c=>{c.songs&&r.songs.push(...c.songs)},M=async c=>{console.log("...url...",c);const V={id:c};try{const S=await x(k.getMusicUrl,{params:V});console.log("...url...",S),S.code===200&&(r.url=S.data[0].url)}catch(S){console.log("...url..",S)}};let p=g(!1);const w=c=>{p.value=c};let y=g("");const h=c=>{y.value=c};return(c,V)=>(i(),u("div",ze,[L(pe,{onGetMusicInfo:a}),L(Ge,{onGetMusicUrl:M,onGetMusicInfo:f,onStopMusic:h,show:n(p),songs:n(r).songs},null,8,["show","songs"]),L(ve,{onGetShow:w,musicUrl:n(r).url,stopFlag:n(y)},null,8,["musicUrl","stopFlag"])]))}});export{Je as default};
