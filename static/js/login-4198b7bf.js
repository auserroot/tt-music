import{u as B,p as n,a as s,g as w}from"./counter-18d95efc.js";import{d as E,r as F,a as I,o as N,c as f,b as c,t as R,F as A,e as l,w as d,E as r,f as m,g as y,h as K,p as L,i as M,u as T,_ as $}from"./index-ed5ac4b7.js";const G=u=>(L("data-v-bb166aff"),u=u(),M(),u),P={class:"warp_box"},X=G(()=>c("h3",null,"wellcome login Ali-music",-1)),z={class:"box"},H={key:1,class:"qrbox"},J=["src"],O=E({__name:"login",setup(u){const t=F({phone:"",captcha:""});let i=null;const g=T(),x=async()=>{const e={phone:t.phone};try{const o=await n(s.getcaptcha,{data:e});console.log("getcaptcha",o),r({message:o.data?"success":"error",type:o.data?"success":"error"})}catch(o){console.log(o)}},q=async()=>{if(t.captcha==="")return r({message:"captcha not null!"});{const e={phone:t.phone,captcha:t.captcha};try{if((await n(s.checkcaptcha,{data:e})).data)try{const a=await n(s.login,{data:{phone:t.phone,captcha:t.captcha}});console.log("login...",a),a.data?(document.cookie=a.cookie)&&g.push("/music"):r({message:a.message,type:"error"})}catch(a){console.log(a)}else return r({message:"plase check captcha!",type:"error"})}catch(o){console.log(o)}}},V=async()=>{try{const e=await n(s.anonimous,{});console.log("anonimous...",e),e.code===200&&(document.cookie=e.cookie)&&g.push("/music")}catch(e){console.log(e)}},p=I(!1),C=()=>{p.value=!p.value,p.value===!1?h():(clearInterval(i),i=null)},k=I(""),S=async()=>{try{const e=await w(s.getQrKey,{});if(console.log("qrkey..",e),e.code===200)return e.data.unikey;r({message:"error!",type:"error"})}catch(e){console.log(e)}},h=async()=>{const e=await S();try{const o=await n(s.getQr,{data:{key:e,qrimg:"qrimg"}});console.log("qr..",o),o.code===200?(k.value=o.data.qrimg,i=setInterval(async()=>{switch(await U(e)){case 800:h();break;case 801:break;case 802:break;case 803:clearInterval(i),i=null;break}},3e3)):r({message:"error!",type:"error"})}catch(o){console.log(o)}},U=async e=>{let o=0;try{const a=await w(s.checkQr,{params:{key:e}});console.log("check..",a),o=a.code,a.code===803&&(document.cookie=a.cookie,Q(a.cookie),g.push("/music"))}catch(a){console.log(a)}return o},v=B(),Q=async e=>{const o={cookie:e},a=await n(s.account,{data:o});console.log("acc..",a),sessionStorage.setItem("login",a.profile.userId?"1":"0"),v.setUserInfo(a.profile)};return N(()=>{h();const e={avatarUrl:"http://p1.music.126.net/IRvBTuxjDcq31SsUCGso9Q==/109951165356903032.jpg",backgroundUrl:"http://p1.music.126.net/lDP67FahDo1vspVjpCXbfA==/109951165731856573.jpg",nickname:"Realm_me",userId:591979276};v.setUserInfo(e)}),(e,o)=>{const a=m("el-input"),b=m("el-form-item"),D=m("el-button"),j=m("el-form");return y(),f("div",P,[X,c("div",z,[c("div",{class:"change",onClick:C},R(p.value?"手机号":"扫码"),1),p.value?(y(),f(A,{key:0},[l(j,{model:t,"label-width":"120px"},{default:d(()=>[l(b,{label:"phone"},{default:d(()=>[l(a,{modelValue:t.phone,"onUpdate:modelValue":o[0]||(o[0]=_=>t.phone=_),placeholder:"enter phone number"},null,8,["modelValue"])]),_:1}),l(b,{class:"captcha",label:"captcha"},{default:d(()=>[l(a,{modelValue:t.captcha,"onUpdate:modelValue":o[1]||(o[1]=_=>t.captcha=_),placeholder:"enter captcha"},null,8,["modelValue"]),l(D,{onClick:x},{default:d(()=>[K("get captcha")]),_:1})]),_:1})]),_:1},8,["model"]),c("div",{class:"login-box"},[c("div",{class:"login",onClick:q},"login"),c("span",{class:"anonimous",onClick:V},"anonimous login")])],64)):(y(),f("div",H,[c("img",{src:k.value,alt:"qr"},null,8,J)]))])])}}});const Z=$(O,[["__scopeId","data-v-bb166aff"]]);export{Z as default};
